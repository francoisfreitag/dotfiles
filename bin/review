#!/bin/sh

set -ue

if (( $# != 1 ))
then
    echo "Usage: review PR_NUMBER"
    exit 1
fi

git reset HEAD
git restore --patch
if test -z $(git status --porcelain | grep -v "??"); then
    git switch "pr/$1" --quiet
    NEW_HEAD="upstream/$(git rev-parse --abbrev-ref HEAD)"
    git reset --hard $NEW_HEAD
    git ctags &
fi
